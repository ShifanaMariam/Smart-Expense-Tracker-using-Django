{% extends 'base.html' %}
{% block content %}
<div class="d-flex justify-content-between align-items-center">
  <h2>Your Expenses</h2>
  <div>
    <a class="btn btn-primary" href="{% url 'expense_add' %}">+ Add Expense</a>
    <a class="btn btn-outline-secondary" href="{% url 'export_csv' %}">Download CSV</a>
  </div>
</div>
<div class="mt-2">
  <a class="btn btn-sm btn-light" href="?filter=today">Today</a>
  <a class="btn btn-sm btn-light" href="?filter=week">This Week</a>
  <a class="btn btn-sm btn-light" href="?filter=month">This Month</a>
</div>
<table class="table mt-3">
  <thead><tr><th>Date</th><th>Description</th><th>Category</th><th>Amount</th><th>Actions</th></tr></thead>
  <tbody>
    {% for e in object_list %}
    <tr>
      <td>{{ e.date }}</td>
      <td>{{ e.description }}</td>
      <td>{{ e.category }}</td>
      <td>₹ {{ e.amount }}</td>
      <td>
        <a class="btn btn-sm btn-outline-primary" href="{% url 'expense_edit' e.pk %}">Edit</a>
        <a class="btn btn-sm btn-outline-danger" href="{% url 'expense_delete' e.pk %}">Delete</a>
      </td>
    </tr>
    {% empty %}
    <tr><td colspan="5">No expenses found.</td></tr>
    {% endfor %}
  </tbody>
</table>
<div class="mt-4">
  <h5>Total: ₹ {{ total }}</h5>
</div>
<div class="mt-4">
  <canvas id="categoryChart" width="400" height="200"></canvas>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
fetch('{% url "chart_data" %}')
  .then(r => r.json())
  .then(data => {
    const ctx = document.getElementById('categoryChart').getContext('2d');
    new Chart(ctx, {
      type: 'pie',
      data: {
        labels: data.labels,
        datasets: [{ data: data.values }]
      }
    });
  });
</script>
{% endblock %}
